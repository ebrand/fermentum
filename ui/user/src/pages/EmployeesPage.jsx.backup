import React, { useState, useEffect } from 'react'
import DashboardLayout from '../components/DashboardLayout'
import EmployeeModal from '../components/EmployeeModal'
import { useSession } from '../contexts/SessionContext'
import { hasPermission, PERMISSIONS } from '../utils/permissions'
import { employeeAPI } from '../utils/api'
import StandardDropdown, { DEPARTMENT_OPTIONS, STATUS_OPTIONS } from '../components/common/StandardDropdown'
import {
  PlusIcon,
  UserIcon,
  PencilIcon,
  TrashIcon,
  MagnifyingGlassIcon,
  FunnelIcon,
  ArrowsUpDownIcon,
  EyeIcon,
  UserPlusIcon,
  BuildingOfficeIcon,
  PhoneIcon,
  EnvelopeIcon,
  CalendarDaysIcon,
  BanknotesIcon,
  ShieldCheckIcon,
  ExclamationTriangleIcon
} from '@heroicons/react/24/outline'

// Mock data based on the database schema
const mockEmployees = [
  {
    employee_id: 1,
    employee_number: 'EMP001',
    first_name: 'John',
    last_name: 'Smith',
    middle_name: 'Michael',
    email: 'john.smith@brewery.com',
    phone: '(555) 123-4567',
    job_title: 'Head Brewer',
    department: 'brewing',
    hire_date: '2023-01-15',
    employment_status: 'active',
    hourly_rate: 28.50,
    access_level: 'supervisor',
    certifications: ['Certified Brew Master', 'Food Safety Certified'],
    is_active: true
  },
  {
    employee_id: 2,
    employee_number: 'EMP002',
    first_name: 'Sarah',
    last_name: 'Johnson',
    email: 'sarah.johnson@brewery.com',
    phone: '(555) 234-5678',
    job_title: 'Sales Manager',
    department: 'sales',
    hire_date: '2023-03-20',
    employment_status: 'active',
    salary_annual: 65000,
    access_level: 'supervisor',
    certifications: ['Sales Professional Certified'],
    is_active: true
  },
  {
    employee_id: 3,
    employee_number: 'EMP003',
    first_name: 'Mike',
    last_name: 'Wilson',
    email: 'mike.wilson@brewery.com',
    phone: '(555) 345-6789',
    job_title: 'Maintenance Technician',
    department: 'maintenance',
    hire_date: '2023-02-10',
    employment_status: 'active',
    hourly_rate: 24.00,
    access_level: 'standard',
    certifications: ['HVAC Certified', 'Electrical Safety'],
    is_active: true
  },
  {
    employee_id: 4,
    employee_number: 'EMP004',
    first_name: 'Emily',
    last_name: 'Davis',
    email: 'emily.davis@brewery.com',
    phone: '(555) 456-7890',
    job_title: 'Brewer',
    department: 'brewing',
    hire_date: '2023-06-01',
    employment_status: 'active',
    hourly_rate: 22.00,
    access_level: 'standard',
    certifications: ['Food Safety Certified'],
    is_active: true
  },
  {
    employee_id: 5,
    employee_number: 'EMP005',
    first_name: 'David',
    last_name: 'Brown',
    email: 'david.brown@brewery.com',
    phone: '(555) 567-8901',
    job_title: 'Quality Control Specialist',
    department: 'quality',
    hire_date: '2023-04-15',
    employment_status: 'active',
    hourly_rate: 26.00,
    access_level: 'standard',
    certifications: ['Quality Assurance Certified', 'Lab Technician'],
    is_active: true
  }
]

const departmentColors = {
  brewing: 'bg-amber-100 text-amber-800',
  sales: 'bg-green-100 text-green-800',
  maintenance: 'bg-blue-100 text-blue-800',
  quality: 'bg-purple-100 text-purple-800',
  admin: 'bg-gray-100 text-gray-800'
}

const statusColors = {
  active: 'bg-green-100 text-green-800',
  inactive: 'bg-yellow-100 text-yellow-800',
  terminated: 'bg-red-100 text-red-800'
}

const accessLevelColors = {
  admin: 'bg-red-100 text-red-800',
  supervisor: 'bg-orange-100 text-orange-800',
  standard: 'bg-blue-100 text-blue-800',
  read_only: 'bg-gray-100 text-gray-800'
}

export default function EmployeesPage() {
  const { user } = useSession()
  const [employees, setEmployees] = useState([])
  const [filteredEmployees, setFilteredEmployees] = useState([])
  const [searchTerm, setSearchTerm] = useState('')
  const [departmentFilter, setDepartmentFilter] = useState('all')
  const [statusFilter, setStatusFilter] = useState('all')
  const [sortField, setSortField] = useState('lastName')
  const [sortDirection, setSortDirection] = useState('asc')
  const [showEmployeeModal, setShowEmployeeModal] = useState(false)
  const [selectedEmployee, setSelectedEmployee] = useState(null)
  const [showDetailsModal, setShowDetailsModal] = useState(false)
  const [loading, setLoading] = useState(true)
  const [saving, setSaving] = useState(false)
  const [error, setError] = useState(null)

  // Permissions
  const canViewEmployees = hasPermission(user, PERMISSIONS.TEAM.VIEW)
  const canManageEmployees = hasPermission(user, PERMISSIONS.TEAM.MANAGE_EMPLOYEES)
  const canManageAccess = hasPermission(user, PERMISSIONS.TEAM.MANAGE_ACCESS)
  const canViewPayroll = hasPermission(user, PERMISSIONS.TEAM.VIEW_PAYROLL)

  // Load employees on component mount
  useEffect(() => {
    loadEmployees()
  }, [])

  const loadEmployees = async () => {
    try {
      setLoading(true)
      setError(null)
      const response = await employeeAPI.getEmployees()
      setEmployees(response.data)
    } catch (err) {
      console.error('Error loading employees:', err)
      setError('Failed to load employees. Please try again.')
      setEmployees([])
    } finally {
      setLoading(false)
    }
  }

  // Filter and search effect
  useEffect(() => {
    let filtered = employees.filter(employee => {
      const matchesSearch = !searchTerm ||
        employee.firstName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        employee.lastName?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        employee.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        employee.employeeNumber?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        employee.jobTitle?.toLowerCase().includes(searchTerm.toLowerCase())

      const matchesDepartment = departmentFilter === 'all' || employee.department === departmentFilter
      const matchesStatus = statusFilter === 'all' || employee.employmentStatus === statusFilter

      return matchesSearch && matchesDepartment && matchesStatus
    })

    // Sort
    filtered.sort((a, b) => {
      let aValue = a[sortField]
      let bValue = b[sortField]

      if (typeof aValue === 'string') {
        aValue = aValue.toLowerCase()
        bValue = bValue.toLowerCase()
      }

      if (sortDirection === 'asc') {
        return aValue < bValue ? -1 : aValue > bValue ? 1 : 0
      } else {
        return aValue > bValue ? -1 : aValue < bValue ? 1 : 0
      }
    })

    setFilteredEmployees(filtered)
  }, [employees, searchTerm, departmentFilter, statusFilter, sortField, sortDirection])

  const handleSort = (field) => {
    if (sortField === field) {
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')
    } else {
      setSortField(field)
      setSortDirection('asc')
    }
  }

  const handleViewDetails = (employee) => {
    setSelectedEmployee(employee)
    setShowDetailsModal(true)
  }

  const handleAddEmployee = () => {
    setSelectedEmployee(null)
    setShowEmployeeModal(true)
  }

  const handleEditEmployee = (employee) => {
    setSelectedEmployee(employee)
    setShowEmployeeModal(true)
  }

  const handleSaveEmployee = async (employeeData) => {
    try {
      setSaving(true)
      if (selectedEmployee) {
        // Update existing employee
        await employeeAPI.updateEmployee(selectedEmployee.employeeId, employeeData)
      } else {
        // Create new employee
        await employeeAPI.createEmployee(employeeData)
      }
      setShowEmployeeModal(false)
      setSelectedEmployee(null)
      await loadEmployees() // Reload the list
    } catch (err) {
      console.error('Error saving employee:', err)
      setError(selectedEmployee ? 'Failed to update employee' : 'Failed to create employee')
    } finally {
      setSaving(false)
    }
  }

  const handleDeleteEmployee = async (employee) => {
    if (window.confirm(`Are you sure you want to delete ${employee.firstName} ${employee.lastName}?`)) {
      try {
        await employeeAPI.deleteEmployee(employee.employeeId)
        await loadEmployees() // Reload the list
      } catch (err) {
        console.error('Error deleting employee:', err)
        setError('Failed to delete employee')
      }
    }
  }

  const formatCurrency = (amount, isHourly = false) => {
    if (!amount) return 'Not specified'
    return isHourly
      ? `$${amount.toFixed(2)}/hr`
      : `$${amount.toLocaleString()}/year`
  }

  const formatDate = (dateString) => {
    if (!dateString) return 'Not specified'
    return new Date(dateString).toLocaleDateString()
  }

  if (!canViewEmployees) {
    return (
      <DashboardLayout title="Access Denied" currentPage="Team">
        <div className="text-center py-12">
          <ExclamationTriangleIcon className="mx-auto h-12 w-12 text-gray-400" />
          <h3 className="mt-2 text-sm font-medium text-gray-900">Access Denied</h3>
          <p className="mt-1 text-sm text-gray-500">
            You don't have permission to view employee information.
          </p>
        </div>
      </DashboardLayout>
    )
  }

  return (
    <DashboardLayout
      title="Employees"
      subtitle="Manage your brewery team and staff information"
      currentPage="Team"
    >
      {/* Header Actions */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div className="flex items-center space-x-4">
          {/* Search */}
          <div className="relative">
            <MagnifyingGlassIcon className="h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" />
            <input
              type="text"
              placeholder="Search employees..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
            />
          </div>

          {/* Department Filter */}
          <StandardDropdown
            value={departmentFilter}
            onChange={(e) => setDepartmentFilter(e.target.value)}
            options={DEPARTMENT_OPTIONS}
            placeholder="All Departments"
          />

          {/* Status Filter */}
          <StandardDropdown
            value={statusFilter}
            onChange={(e) => setStatusFilter(e.target.value)}
            options={STATUS_OPTIONS}
            placeholder="All Status"
          />
        </div>

        {/* Add Employee Button */}
        {canManageEmployees && (
          <button
            onClick={handleAddEmployee}
            className="inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
          >
            <UserPlusIcon className="h-5 w-5 mr-2" />
            Add Employee
          </button>
        )}
      </div>

      {/* Error Message */}
      {error && (
        <div className="mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg">
          <div className="flex">
            <ExclamationTriangleIcon className="h-5 w-5 mr-2" />
            <span>{error}</span>
            <button
              onClick={() => setError(null)}
              className="ml-auto text-red-500 hover:text-red-700"
            >
              ×
            </button>
          </div>
        </div>
      )}

      {/* Loading State */}
      {loading ? (
        <div className="text-center py-12">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Loading employees...</p>
        </div>
      ) : (
        <div>
          {/* Employee Stats */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <div className="flex items-center">
            <UserIcon className="h-8 w-8 text-blue-600" />
            <div className="ml-4">
              <p className="text-sm font-medium text-gray-600">Total Employees</p>
              <p className="text-2xl font-bold text-gray-900">{employees.length}</p>
            </div>
          </div>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <div className="flex items-center">
            <BuildingOfficeIcon className="h-8 w-8 text-green-600" />
            <div className="ml-4">
              <p className="text-sm font-medium text-gray-600">Active</p>
              <p className="text-2xl font-bold text-gray-900">
                {employees.filter(e => e.employmentStatus === 'active').length}
              </p>
            </div>
          </div>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <div className="flex items-center">
            <ShieldCheckIcon className="h-8 w-8 text-purple-600" />
            <div className="ml-4">
              <p className="text-sm font-medium text-gray-600">Supervisors</p>
              <p className="text-2xl font-bold text-gray-900">
                {employees.filter(e => e.accessLevel === 'supervisor').length}
              </p>
            </div>
          </div>
        </div>

        <div className="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <div className="flex items-center">
            <CalendarDaysIcon className="h-8 w-8 text-orange-600" />
            <div className="ml-4">
              <p className="text-sm font-medium text-gray-600">New This Month</p>
              <p className="text-2xl font-bold text-gray-900">2</p>
            </div>
          </div>
        </div>
      </div>

      {/* Employee Table */}
      <div className="bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden">
        <div className="overflow-x-auto">
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                  onClick={() => handleSort('employee_number')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Employee #</span>
                    <ArrowsUpDownIcon className="h-4 w-4" />
                  </div>
                </th>
                <th
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                  onClick={() => handleSort('last_name')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Name</span>
                    <ArrowsUpDownIcon className="h-4 w-4" />
                  </div>
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Contact
                </th>
                <th
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                  onClick={() => handleSort('job_title')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Position</span>
                    <ArrowsUpDownIcon className="h-4 w-4" />
                  </div>
                </th>
                <th
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                  onClick={() => handleSort('department')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Department</span>
                    <ArrowsUpDownIcon className="h-4 w-4" />
                  </div>
                </th>
                <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Access Level
                </th>
                <th
                  className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100"
                  onClick={() => handleSort('employment_status')}
                >
                  <div className="flex items-center space-x-1">
                    <span>Status</span>
                    <ArrowsUpDownIcon className="h-4 w-4" />
                  </div>
                </th>
                <th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {filteredEmployees.map((employee) => (
                <tr key={employee.employeeId} className="hover:bg-gray-50">
                  <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                    {employee.employeeNumber}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <div className="flex items-center">
                      <div className="h-10 w-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span className="text-sm font-medium text-white">
                          {employee.firstName?.[0]}{employee.lastName?.[0]}
                        </span>
                      </div>
                      <div className="ml-4">
                        <div className="text-sm font-medium text-gray-900">
                          {employee.firstName} {employee.lastName}
                        </div>
                        <div className="text-sm text-gray-500">
                          {employee.jobTitle}
                        </div>
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    <div className="space-y-1">
                      <div className="flex items-center">
                        <EnvelopeIcon className="h-4 w-4 mr-2" />
                        {employee.email}
                      </div>
                      <div className="flex items-center">
                        <PhoneIcon className="h-4 w-4 mr-2" />
                        {employee.phone}
                      </div>
                    </div>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                    {employee.jobTitle}
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${departmentColors[employee.department] || departmentColors.admin}`}>
                      {employee.department}
                    </span>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${accessLevelColors[employee.accessLevel] || accessLevelColors.standard}`}>
                      {employee.accessLevel}
                    </span>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap">
                    <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${statusColors[employee.employmentStatus] || statusColors.active}`}>
                      {employee.employmentStatus}
                    </span>
                  </td>
                  <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <div className="flex items-center justify-end space-x-2">
                      <button
                        onClick={() => handleViewDetails(employee)}
                        className="text-blue-600 hover:text-blue-900 p-1 rounded"
                        title="View Details"
                      >
                        <EyeIcon className="h-4 w-4" />
                      </button>
                      {canManageEmployees && (
                        <>
                          <button
                            onClick={() => handleEditEmployee(employee)}
                            className="text-indigo-600 hover:text-indigo-900 p-1 rounded"
                            title="Edit Employee"
                          >
                            <PencilIcon className="h-4 w-4" />
                          </button>
                          <button
                            onClick={() => handleDeleteEmployee(employee)}
                            className="text-red-600 hover:text-red-900 p-1 rounded"
                            title="Remove Employee"
                          >
                            <TrashIcon className="h-4 w-4" />
                          </button>
                        </>
                      )}
                    </div>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        {filteredEmployees.length === 0 && (
          <div className="text-center py-12">
            <UserIcon className="mx-auto h-12 w-12 text-gray-400" />
            <h3 className="mt-2 text-sm font-medium text-gray-900">No employees found</h3>
            <p className="mt-1 text-sm text-gray-500">
              {searchTerm || departmentFilter !== 'all' || statusFilter !== 'all'
                ? 'Try adjusting your search criteria.'
                : 'Get started by adding your first employee.'
              }
            </p>
          </div>
        )}
      </div>

      {/* Employee Details Modal */}
      {showDetailsModal && selectedEmployee && (
        <div className="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
          <div className="relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white">
            <div className="mt-3">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-lg font-bold text-gray-900">Employee Details</h3>
                <button
                  onClick={() => setShowDetailsModal(false)}
                  className="text-gray-400 hover:text-gray-600"
                >
                  <span className="sr-only">Close</span>
                  ✕
                </button>
              </div>

              <div className="space-y-6">
                {/* Basic Information */}
                <div>
                  <h4 className="text-md font-semibold text-gray-900 mb-3">Personal Information</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Full Name</label>
                      <p className="mt-1 text-sm text-gray-900">
                        {selectedEmployee.first_name} {selectedEmployee.middle_name} {selectedEmployee.last_name}
                      </p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Employee Number</label>
                      <p className="mt-1 text-sm text-gray-900">{selectedEmployee.employee_number}</p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Email</label>
                      <p className="mt-1 text-sm text-gray-900">{selectedEmployee.email}</p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Phone</label>
                      <p className="mt-1 text-sm text-gray-900">{selectedEmployee.phone}</p>
                    </div>
                  </div>
                </div>

                {/* Employment Information */}
                <div>
                  <h4 className="text-md font-semibold text-gray-900 mb-3">Employment Details</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Job Title</label>
                      <p className="mt-1 text-sm text-gray-900">{selectedEmployee.job_title}</p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Department</label>
                      <p className="mt-1 text-sm text-gray-900">
                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${departmentColors[selectedEmployee.department]}`}>
                          {selectedEmployee.department}
                        </span>
                      </p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Hire Date</label>
                      <p className="mt-1 text-sm text-gray-900">{formatDate(selectedEmployee.hire_date)}</p>
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Employment Status</label>
                      <p className="mt-1 text-sm text-gray-900">
                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${statusColors[selectedEmployee.employment_status]}`}>
                          {selectedEmployee.employment_status}
                        </span>
                      </p>
                    </div>
                  </div>
                </div>

                {/* Compensation (only if user has payroll permissions) */}
                {canViewPayroll && (
                  <div>
                    <h4 className="text-md font-semibold text-gray-900 mb-3">Compensation</h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {selectedEmployee.hourly_rate && (
                        <div>
                          <label className="block text-sm font-medium text-gray-700">Hourly Rate</label>
                          <p className="mt-1 text-sm text-gray-900">{formatCurrency(selectedEmployee.hourly_rate, true)}</p>
                        </div>
                      )}
                      {selectedEmployee.salary_annual && (
                        <div>
                          <label className="block text-sm font-medium text-gray-700">Annual Salary</label>
                          <p className="mt-1 text-sm text-gray-900">{formatCurrency(selectedEmployee.salary_annual, false)}</p>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* Access & Permissions */}
                <div>
                  <h4 className="text-md font-semibold text-gray-900 mb-3">System Access</h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700">Access Level</label>
                      <p className="mt-1 text-sm text-gray-900">
                        <span className={`inline-flex px-2 py-1 text-xs font-medium rounded-full ${accessLevelColors[selectedEmployee.access_level]}`}>
                          {selectedEmployee.access_level}
                        </span>
                      </p>
                    </div>
                  </div>
                </div>

                {/* Certifications */}
                {selectedEmployee.certifications && selectedEmployee.certifications.length > 0 && (
                  <div>
                    <h4 className="text-md font-semibold text-gray-900 mb-3">Certifications</h4>
                    <div className="flex flex-wrap gap-2">
                      {selectedEmployee.certifications.map((cert, index) => (
                        <span key={index} className="inline-flex px-3 py-1 text-sm font-medium bg-green-100 text-green-800 rounded-full">
                          {cert}
                        </span>
                      ))}
                    </div>
                  </div>
                )}
              </div>

              <div className="mt-6 flex justify-end space-x-3">
                <button
                  onClick={() => setShowDetailsModal(false)}
                  className="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"
                >
                  Close
                </button>
                {canManageEmployees && (
                  <button className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    Edit Employee
                  </button>
                )}
              </div>
            </div>
          </div>
        </div>
        </div>
      )}

      {/* Employee Modal */}
      <EmployeeModal
        isOpen={showEmployeeModal}
        onClose={() => setShowEmployeeModal(false)}
        onSave={handleSaveEmployee}
        employee={selectedEmployee}
        isLoading={saving}
      />
    </DashboardLayout>
  )
}